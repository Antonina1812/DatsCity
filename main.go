package main

import (
	g "datscity/game"
	"fmt"
	"log"
	"math/rand"
	"net/http"
	"time"
)

var (
	// completedTowers []g.Tower
	// currentTower    g.Tower
	// totalScore      float64
	// gameState       g.GameState
	// rounds          []g.Round
	availableWords []g.Word
)

var wordList = []string{
	"извратитель",
	"феноменология",
	"необъективность",
	"предплужник",
	"человеконенавистник",
	"подвозчица",
	"насадка",
	"лопушник",
	"обводчик",
	"онанист",
	"копуляция",
	"сизаль",
	"куркума",
	"мостовина",
	"пальба",
	"ясачник",
	"подсек",
	"собранность",
	"иммиграция",
	"придача",
	"электричка",
	"ихтиоз",
	"пчеловод",
	"предвестие",
	"гудронатор",
	"швейцарец",
	"детская",
	"армянин",
	"циркон",
	"чревоугодник",
	"счёска",
	"кутание",
	"погромщик",
	"полеводство",
	"передумывание",
	"успокоение",
	"переборщица",
	"дягиль",
	"космополитка",
	"ныряло",
	"мануфактурсоветник",
	"сардоникс",
	"туземка",
	"некомпетентность",
	"палас",
	"сутяжник",
	"бытовизм",
	"пылкость",
	"многомужие",
	"валидол",
	"парадизка",
	"прозодежда",
	"нечаянность",
	"обдирание",
	"разъяснитель",
	"мерка",
	"защитник",
	"соковыжималка",
	"наказуемость",
	"фикция",
	"подстраивание",
	"остойчивость",
	"опрощенец",
	"подвиливание",
	"взаимопроникновение",
	"сложность",
	"ларчик",
	"сочевичник",
	"перестрагивание",
	"синхронизм",
	"диагностирование",
	"оживка",
	"заслушание",
	"индейководство",
	"дешифратор",
	"лахтак",
	"пруссак",
	"брас",
	"наёмничество",
	"копировщик",
	"отмывание",
	"культпоход",
	"предстоящее",
	"алеут",
	"лампион",
	"замуровывание",
	"гаммаустановка",
	"маслодел",
	"неграмотность",
	"неразличимость",
	"штундизм",
	"причащение",
	"полифония",
	"кувыркание",
	"кан",
	"недогляд",
	"магичность",
	"синеватость",
	"клавикорд",
	"коммивояжёрство",
	"куранта",
	"издольщик",
	"майордом",
	"европеизация",
	"хлёсткость",
	"выверение",
	"флотилия",
	"фитиль",
	"идолопоклонство",
	"возникновение",
	"пасьянс",
	"микрорайон",
	"скальд",
	"подвижник",
	"вендетта",
	"неразвитость",
	"келейник",
	"порез",
	"допашка",
	"зюйд",
	"кольт",
	"атака",
	"прополис",
	"злостность",
	"склёпывание",
	"корд",
	"характеристичность",
	"гнездование",
	"отбой",
	"экстернат",
	"сапонин",
	"биогеоценология",
	"модернистка",
	"федералист",
	"осведомительница",
	"изгнание",
	"продукт",
	"шквара",
	"миноискатель",
	"колодезь",
	"усекание",
	"разгадчица",
	"коринка",
	"подслащивание",
	"ихтиология",
	"рассылание",
	"лимфоцит",
	"торошение",
	"перезарядка",
	"неумолимость",
	"блондин",
	"верховенство",
	"переснащивание",
	"плис",
	"мужественность",
	"агитация",
	"взвывание",
	"закройная",
	"землепашец",
	"недокос",
	"кирзач",
	"трапезарь",
	"крем",
	"нейропатология",
	"невольница",
	"тыквина",
	"классика",
	"скип",
	"гагаузка",
	"налокотник",
	"крахмаление",
	"келейница",
	"доктринёрство",
	"прожировка",
	"югослав",
	"неточность",
	"недоброжелательность",
	"подтаптывание",
	"слушательница",
	"поярок",
	"умирание",
	"рассечение",
	"наличник",
	"хлорофилл",
	"соглядатайство",
	"шествие",
	"регистратура",
	"навозоразбрасыватель",
	"порция",
	"правдолюбие",
	"кабель",
	"примирённость",
	"мраморщик",
	"цежение",
	"моторизация",
	"штабквартира",
	"тигрёнок",
	"замерзание",
	"ворожей",
	"развальца",
	"испытание",
	"кровельщик",
	"невыгодность",
	"страусятина",
	"сберегание",
	"распря",
	"лёсс",
	"тактильность",
	"даурка",
	"рецидивистка",
	"душевность",
	"привой",
	"корнетист",
	"подвязка",
	"дарение",
	"комизм",
	"соединитель",
	"автотягач",
	"кокаин",
	"подсол",
	"синтепон",
	"монарх",
	"жеребьёвка",
	"артишок",
	"клятвопреступление",
	"пристрагивание",
	"тюркизм",
	"разбежка",
	"прогрессивность",
	"опутывание",
}

func init() {

	// gameState := g.GameState{
	// 	MapSize:     [3]int{30, 30, 100},
	// 	NextTurnSec: 60,
	// 	RoundEndsAt: time.Now().Add(time.Minute * 5),
	// 	ShuffleLeft: 3,
	// 	Turn:        1,
	// 	UsedIndexes: []int{},
	// 	Words:       []g.Word{},
	// }

	availableWords = make([]g.Word, len(wordList))
	for i, w := range wordList {
		availableWords[i] = g.Word{ID: i + 1, Word: w}
	}

	// rounds := []g.Round{
	// 	{StartTime: time.Now(), EndTime: time.Now().Add(time.Minute * 10)},
	// 	{StartTime: time.Now(), EndTime: time.Now().Add(time.Minute * 15)},
	// }

	rand.Seed(time.Now().UnixNano())
}

func main() {
	http.HandleFunc("/api/build", g.HandleBuild)
	http.HandleFunc("/api/shuffle", g.HandleShuffle)
	http.HandleFunc("/api/towers", g.HandleTowers)
	http.HandleFunc("/api/words", g.HandleWords)
	http.HandleFunc("/api/rounds", g.HandleRounds)

	fmt.Printf("Server listening on port %s\n", g.ServerPort)
	log.Fatal(http.ListenAndServe(":"+g.ServerPort, nil))
}
